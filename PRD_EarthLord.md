# EarthLord（地球领主）产品需求文档 (PRD)

**版本**: 1.0
**日期**: 2025-12-24
**状态**: 初稿

---

## 1. 产品概述

### 1.1 产品名称
**EarthLord（地球领主）**

### 1.2 产品定位
一款基于真实地理位置（LBS）的末日生存手机游戏，玩家通过真实世界的行走来圈地占领、探索搜刮、建造家园，实现"Walk to Earn"的核心体验。

### 1.3 目标用户
- 喜欢户外运动、跑步、骑行的健身爱好者
- 《宝可梦GO》类LBS游戏玩家
- 末日生存题材游戏爱好者（《饥荒》《方舟》《Rust》玩家）
- 18-40岁，具有智能手机和户外活动习惯的用户

### 1.4 产品愿景
让用户通过真实的行走和探索，在虚拟的末日世界中建立属于自己的家园，将运动健身与游戏娱乐完美结合。

---

## 2. 市场分析

### 2.1 市场背景
| 对标产品 | 累计收入 | 核心玩法 |
|---------|---------|---------|
| 宝可梦GO | 60亿美元+ | LBS + 收集 |
| Keep | 百亿估值 | 运动记录 |
| 滴滴/Uber | 千亿市值 | GPS定位 |

### 2.2 差异化优势
- **Walk to Earn**: 走路即可获得游戏资源
- **真实圈地**: 用GPS轨迹画出属于自己的领地
- **末日生存主题**: 独特的"希望朋克"视觉风格
- **社交交易**: 基于位置的玩家互动和物品交易

---

## 3. 功能需求

### 3.1 功能模块总览

```
┌─────────────────────────────────────────────────────────────┐
│                      游戏核心循环                            │
├─────────────────────────────────────────────────────────────┤
│   登录注册 → 圈地占领 → 探索搜刮 → 获得资源                   │
│      ↑                              ↓                       │
│      │         ┌──────────────────────────────┐            │
│      │         │  资源用途：                    │            │
│      │         │  • 建造建筑（消耗资源）         │            │
│      │         │  • 交易换物（流通资源）         │            │
│      │         │  • 生存消耗（食物/水）          │            │
│      │         └──────────────────────────────┘            │
│      │                              ↓                       │
│      └──────── 通讯社交 ← 成就排行 ← 发展壮大               │
└─────────────────────────────────────────────────────────────┘
```

---

### 3.2 第一部分：登录与圈地系统

#### 3.2.1 登录注册系统
**优先级**: P0（核心功能）

| 需求项 | 描述 | 验收标准 |
|-------|------|---------|
| 邮箱注册 | 用户名+密码传统登录方式 | 支持邮箱验证、密码重置 |
| Apple登录 | OAuth一键登录 | iOS系统无缝集成 |
| Google登录 | OAuth一键登录 | 海外用户支持 |
| 会话管理 | 自动登录、多设备支持 | 30天免登录 |

**技术依赖**: Supabase Auth

#### 3.2.2 GPS圈地系统
**优先级**: P0（核心功能）

| 需求项 | 描述 | 验收标准 |
|-------|------|---------|
| 卫星地图显示 | 末日风格的地图界面 | 苹果MapKit集成 |
| 实时GPS追踪 | 玩家移动轨迹记录 | 精度<10米 |
| 轨迹绘制 | 蓝色线条显示行走路径 | 实时刷新 |
| 多边形闭合 | 回到起点附近自动闭合 | 误差<50米 |
| 合法性验证 | 检查作弊、重叠 | 防GPS模拟器 |
| 面积计算 | 计算圈地面积 | 精确到平方米 |

**技术依赖**: Apple MapKit、CoreLocation

#### 3.2.3 领地管理
**优先级**: P0（核心功能）

| 需求项 | 描述 | 验收标准 |
|-------|------|---------|
| 领地命名 | 自定义领地名称 | 支持中英文 |
| 领地详情 | 展示面积、建筑数量 | 实时更新 |
| 交易开关 | 允许/禁止其他玩家交易 | 100米范围触发 |
| 领地活跃度 | 30天内需活跃，否则回收 | 系统通知提醒 |

**技术依赖**: Supabase Database、PostGIS

---

### 3.3 第二部分：探索与资源获取

#### 3.3.1 POI发现与搜刮
**优先级**: P0（核心功能）

| 需求项 | 描述 | 验收标准 |
|-------|------|---------|
| POI识别 | 识别现实世界真实地点 | Apple MapKit POI数据 |
| 地理围栏 | 进入范围自动触发 | 50-100米触发范围 |
| 搜刮功能 | 点击获取资源 | 冷却时间限制 |
| 资源类型映射 | 不同POI产出不同资源 | 见下表 |

**POI与资源对应表**:

| POI类型 | 产出资源 |
|--------|---------|
| 医院、药店 | 药品（急救包、抗生素）|
| 超市、餐厅 | 食物（罐头、饮用水）|
| 工厂、工地 | 金属材料 |
| 公园、林地 | 木材 |
| 银行、珠宝店 | 稀有材料 |

#### 3.3.2 探索成就
**优先级**: P1

| 需求项 | 描述 | 验收标准 |
|-------|------|---------|
| 探索距离统计 | 记录行走距离 | 精确到0.01km |
| 探索时长统计 | 记录探索时间 | 精确到分钟 |
| 探索奖励 | 根据距离/时长发放奖励 | 奖励公式可配置 |

#### 3.3.3 背包系统
**优先级**: P0（核心功能）

| 需求项 | 描述 | 验收标准 |
|-------|------|---------|
| 背包容量 | 默认100格 | 可通过建筑扩容 |
| 物品存储 | 存储收集的资源 | 分类展示 |
| 容量显示 | 进度条显示已用/总容量 | 41/100格式 |
| 本地优先 | 离线可查看背包 | 网络恢复后同步 |

---

### 3.4 第三部分：建造与交易系统

#### 3.4.1 建造系统
**优先级**: P0（核心功能）

| 需求项 | 描述 | 验收标准 |
|-------|------|---------|
| 建筑列表 | 15种建筑，4大分类 | 见下表 |
| 资源消耗 | 建造需消耗资源 | 资源不足提示 |
| 位置选择 | 拖动选择建造位置 | 领地内有效 |
| 建造动画 | 建造过程视觉反馈 | 完成提示 |

**建筑分类表**:

| 分类 | 建筑示例 | 功能 |
|-----|---------|-----|
| 生存类 | 篝火、庇护所 | 取暖、休息 |
| 储存类 | 小仓库、中仓库 | 扩展背包容量 |
| 生产类 | 农田、工作台 | 生产资源 |
| 能源类 | 太阳能板、风力发电机 | 提供能源 |

**建筑等级**: Tier 1（生存基础）→ Tier 2（功能扩展）→ Tier 3（高级设施）

#### 3.4.2 建筑状态管理
**优先级**: P1

| 状态 | 描述 | 可执行操作 |
|-----|------|----------|
| 建造中 | 施工阶段 | 取消 |
| 待激活 | 建好未启用 | 激活 |
| 运行中 | 正常工作 | 升级、停用 |
| 损坏 | 需要维修 | 维修 |

#### 3.4.3 交易系统
**优先级**: P1

| 需求项 | 描述 | 验收标准 |
|-------|------|---------|
| 发布挂单 | 选择"我提供"和"我需要" | 物品选择器 |
| 挂单列表 | 展示附近可用交易 | 100米范围可见 |
| 接受交易 | 一键完成交易 | 资源自动转移 |
| 交易历史 | 记录所有交易 | 可追溯 |

---

### 3.5 第四部分：通讯系统

#### 3.5.1 消息中心
**优先级**: P1

| 需求项 | 描述 | 验收标准 |
|-------|------|---------|
| 官方消息 | 系统公告、活动通知 | 未读标记 |
| 生存指南 | 新手教程 | 分步骤展示 |
| 每日任务 | 每日活动目标 | 奖励显示 |

#### 3.5.2 公共频道聊天
**优先级**: P1

| 需求项 | 描述 | 验收标准 |
|-------|------|---------|
| 基于位置 | 3km范围内可见 | 位置过滤 |
| 实时消息 | 消息秒级送达 | Supabase Realtime |
| 覆盖范围显示 | 顶部显示"覆盖范围 3km" | 动态更新 |

#### 3.5.3 频道管理
**优先级**: P2

| 需求项 | 描述 | 验收标准 |
|-------|------|---------|
| 创建频道 | 自定义频道名称 | 唯一性检查 |
| 加入/退出 | 管理频道成员 | 在线人数显示 |
| 频道列表 | 展示频道名、距离、在线人数 | 按距离排序 |

#### 3.5.4 PTT呼叫
**优先级**: P2

| 需求项 | 描述 | 验收标准 |
|-------|------|---------|
| 长按发送 | 模拟对讲机操作 | 按住录音 |
| 频率显示 | 显示当前频率 | 如"438.000" |
| 语音转发 | 发送到公共频道 | 实时播放 |

#### 3.5.5 通讯设备等级
**优先级**: P1

| 设备 | 功能 | 覆盖范围 |
|-----|------|---------|
| 收音机 | 只能接收 | - |
| 对讲机 | 收发 | 3km |
| 营地电台 | 收发 | 10km |
| 卫星通讯 | 收发 | 全球 |

---

### 3.6 第五部分：个人中心与商业化

#### 3.6.1 个人主页
**优先级**: P1

| 需求项 | 描述 | 验收标准 |
|-------|------|---------|
| 玩家档案 | 幸存者等级、存活天数 | 实时更新 |
| 领地统计 | 领地数量、总面积 | 累计统计 |
| 建筑统计 | 建筑数量 | 分类展示 |

#### 3.6.2 多语言设置
**优先级**: P1

| 需求项 | 描述 | 验收标准 |
|-------|------|---------|
| 语言切换 | 简体中文、繁体中文、English | 即时切换 |
| 应用重启 | 切换后自动重启应用 | 提示用户 |

#### 3.6.3 付费订阅系统
**优先级**: P0（变现核心）

**订阅产品**:

| 产品名 | 价格 | 权益 |
|-------|------|-----|
| 开拓者月卡 | $9.99/月 | 无限探索、范围扩大 |
| 领主通行证 | $19.99/月 | 所有特权 |

**一次性购买**:

| 产品名 | 价格 | 内容 |
|-------|------|-----|
| 初级物资包 | $0.99 | 基础资源 |
| 中级物资包 | $2.99 | 中级资源 |
| 稀有资源包 | $9.99 | 稀有材料 |

**技术依赖**: StoreKit 2

#### 3.6.4 排行榜
**优先级**: P2

| 榜单类型 | 排名依据 |
|---------|---------|
| 领地面积榜 | 总领地面积 |
| 探索废墟榜 | 搜刮次数 |
| 建筑数量榜 | 建筑总数 |

#### 3.6.5 成就系统
**优先级**: P2

| 成就类型 | 示例 | 奖励 |
|---------|-----|-----|
| 新手成就 | 末世拾荒者（首次搜刮）| 100金币 |
| 进阶成就 | 新手领主（首次圈地）| 200金币 |
| 稀有成就 | 隐藏挑战 | 稀有道具 |

**稀有度等级**: 普通 → 稀有 → 史诗 → 传说

#### 3.6.6 生存体征系统
**优先级**: P1

| 体征 | 描述 | 衰减速度 |
|-----|------|---------|
| 核心生命 | 100为满，降到0死亡 | 依赖饱食度和水分 |
| 饱食度 | 需要持续进食 | -5/小时 |
| 水分 | 需要持续饮水 | -10/小时 |

**增益机制**: 饱食度/水分 > 80% 时获得探索效率加成

---

## 4. 非功能需求

### 4.1 性能需求
| 指标 | 要求 |
|-----|------|
| 启动时间 | < 3秒 |
| GPS刷新频率 | 1次/秒 |
| 地图加载 | < 2秒 |
| 消息延迟 | < 1秒 |

### 4.2 安全需求
| 需求项 | 描述 |
|-------|------|
| GPS反作弊 | 检测模拟器、异常移动速度 |
| 数据加密 | HTTPS传输、本地加密存储 |
| 支付安全 | 苹果IAP担保 |

### 4.3 可用性需求
| 需求项 | 描述 |
|-------|------|
| 离线支持 | 背包、设置可离线使用 |
| 多设备同步 | 云端数据实时同步 |
| 国际化 | 支持多语言切换 |

---

## 5. 技术架构

### 5.1 技术栈
| 层级 | 技术选型 |
|-----|---------|
| 前端 | Swift / SwiftUI |
| 地图 | Apple MapKit |
| 定位 | CoreLocation |
| 后端 | Supabase (PostgreSQL + PostGIS) |
| 认证 | Supabase Auth |
| 实时通讯 | Supabase Realtime |
| 支付 | StoreKit 2 |

### 5.2 核心代码模块

| 功能 | 代码文件 |
|-----|---------|
| 登录注册 | AuthManager.swift |
| GPS圈地 | LocationManager.swift |
| 领地管理 | TerritoryManager.swift |
| POI发现 | POIManager.swift |
| 探索搜刮 | ExplorationManager.swift |
| 背包系统 | ItemManager.swift |
| 建造系统 | BuildingManager.swift |
| 交易系统 | TradeManager.swift |
| 消息中心 | RadioManager.swift |
| 实时聊天 | CommunicationManager.swift |
| 频道管理 | ChannelManager.swift |
| 内购支付 | StoreKitManager.swift |
| 排行榜 | LeaderboardManager.swift |
| 成就系统 | AchievementManager.swift |
| 生存体征 | VitalSignsManagerV2.swift |

---

## 6. 里程碑规划

| 阶段 | 功能范围 | 状态 |
|-----|---------|-----|
| MVP | 登录 + 圈地 + 探索 + 背包 | 待开发 |
| V1.0 | + 建造 + 交易 | 待开发 |
| V1.5 | + 通讯系统 | 待开发 |
| V2.0 | + 排行榜 + 成就 + 付费 | 待开发 |

---

## 7. 风险与应对

| 风险 | 应对策略 |
|-----|---------|
| GPS精度问题 | 增加容错机制，模糊匹配 |
| 电量消耗 | 优化定位频率，后台低功耗模式 |
| 作弊行为 | 速度检测、轨迹分析、举报机制 |
| 用户留存 | 成就系统、每日任务、社交功能 |

---

**文档结束**
